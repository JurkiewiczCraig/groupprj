<!-- Maps were inspired by https://www.youtube.com/watch?v=NyjMmNCtKf4&t=5s 
and https://github.com/timwis/leaflet-choropleth -->


<!DOCTYPE html>
<html>

	<head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />    <title>Find Your Block's Walkability Score with Geolocation</title>

    <!-- Load Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js"></script>
    <script src="https://unpkg.com/esri-leaflet-vector@4.2.3/dist/esri-leaflet-vector.js"></script>
<!--adding in the greyscale tiles, the choropleth javascript data and the data from the walkability geojson file -->
		<script src="TileLayer.Grayscale.js"></script>
	  <script src = "walkindex.js"> </script> 
    <style>
     <!-- adding style to the map and headers -->
	    body {
        margin: 0;
        padding: 0;
      }
      html, body, #map {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;}

	       h1 {text-align: center;
       margin: 0px;
       }
    h2 {text-align: center;
         margin: 0px;}
.legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}

	    
    </style>
  </head>

  <body>
 <h1>Walkability Scores in New York City</h1>
	  <h2>Note that the color on the choropleth map is associated with the range in Walkability scores in this region, and is not indicitive of the entire United States</h2>
	  <div id="map"></div>

    <script>
  
    

   
 <!--adding in the greyscale basemap -->
  const map = L.map('map', { fadeAnimation: false }).setView([25, -4], 3);
        L.tileLayer.grayscale('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 18, minZoom: 2
        }).addTo(map);
    


  <!-- adding accuracy to the geolocator-->
const options = {
    enableHighAccuracy: true, 
    timeout: 5000, 
    maximumAge: 2000, 
    
};
	    <!-- Creating a marker and circle icon for the geolocator-->
let marker, circle, zoomed;
  
<!-- adding the navigator geolocator that calls the function everytime the users location updates-->
  navigator.geolocation.watchPosition(success, error, options);
 <!-- function to run when the map gets the users location successfully-->
  function success(pos) {

    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    const accuracy = pos.coords.accuracy; 
<!-- adding in marker and circle for users location to be shown on the map -->
<!-- adding in an if statement to delete any old markers that may exist -->
  if (marker) {
        map.removeLayer(marker);
        map.removeLayer(circle);
    }  
  
  marker = L.marker([lat, lng]).addTo(map);
  circle = L.circle([lat, lng], { radius: accuracy }).addTo(map);
  
 <!-- adding in an if statement to have the circle update in tandem with map zoom level -->
  if (!zoomed) {
        zoomed = map.fitBounds(circle.getBounds()); 
    }
  <!-- keeping the map at the same zoom level whenever the map location changes -->
if (!zoomed) {
        zoomed = map.fitBounds(circle.getBounds()); 
    }
  <!--setting the map focus to update with the users position -->
   map.setView([lat, lng]);
    

}

function error(err) {
<!-- asking the user if they do not allow geolocatoion access or if there is a user error -->
    if (err.code === 1) {
        alert("Please allow geolocation access");
    } else {
        alert("Cannot get current location");
    }
}


<!--adding color to the feature layer based off of a field  that will be set below -->
function getColor(d) {
    return d >= 20 ? '#38A800' :
	   d > 15.52 ? '#38A800' :
           d > 10.5  ? '#A3FF73' :
           d > 5.75  ? '#FFFF73' :
              '#FFAA00';
                    
}
	    <!-- adding style to the feature NatWalkInd with the combined colors frmo the code above-->
function style(feature) {
    return {
        fillColor: getColor(feature.properties.NatWalkInd),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

L.geoJson(WalkIndex, {style: style}).addTo(map);

<!-- adding a legend to the map  with 4 intervels -->
  var legend = L.control({position: 'bottomright'});	    
legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
    grades = [1, 5.75, 10.51,15.25],
    labels = [];

    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
}

return div;
};

legend.addTo(map);



	    
    </script>
  </body>
</html>
