<!-- Maps were inspired by https://www.youtube.com/watch?v=NyjMmNCtKf4&t=5s 
and https://github.com/timwis/leaflet-choropleth -->


<!DOCTYPE html>
<html>

	<head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />    <title>Find Your Block's Walkability Score with Geolocation</title>

    <!-- Load Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js"></script>
    <script src="https://unpkg.com/esri-leaflet-vector@4.2.3/dist/esri-leaflet-vector.js"></script>
<!--adding in the greyscale tiles, the choropleth javascript data and the data from the walkability geojson file -->
		<script src="TileLayer.Grayscale.js"></script>
    <script src = "leaflet-choropleth-gh-pages/dist/choropleth.js"></script>
	  <script src = "walkindex.js"> </script> 
    <style>
     <!-- adding style to the map and headers -->
	    body {
        margin: 0;
        padding: 0;
      }
      html, body, #map {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;}

	       h1 {text-align: center;
       margin: 0px;
       }
    h2 {text-align: center;
         margin: 0px;}
    </style>
  </head>

  <body>
 <h1>Walkability Scores in New York City</h1>
	  <h2>Note that the color on the choropleth map is associated with the range in Walkability scores in this region, and is not indicitive of the entire United States</h2>
	  <div id="map"></div>

    <script>
  
    

   
 <--adding in the greyscale basemap -->
  const map = L.map('map', { fadeAnimation: false }).setView([25, -4], 3);
        L.tileLayer.grayscale('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 14, minZoom: 2
        }).addTo(map);
    


  <!-- adding accuracy to the geolocator-->
const options = {
    enableHighAccuracy: true, 
    timeout: 5000, 
    maximumAge: 2000, 
    
};
	    <!-- Creating a marker and circle icon for the geolocator-->
let marker, circle, zoomed;
  
<!-- adding the navigator geolocator that calls the function everytime the users location updates-->
  navigator.geolocation.watchPosition(success, error, options);
 <!-- function to run when the map gets the users location successfully-->
  function success(pos) {

    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    const accuracy = pos.coords.accuracy; 
<!-- adding in marker and circle for users location to be shown on the map -->
<!-- adding in an if statement to delete any old markers that may exist -->
  if (marker) {
        map.removeLayer(marker);
        map.removeLayer(circle);
    }  
  
  marker = L.marker([lat, lng]).addTo(map);
  circle = L.circle([lat, lng], { radius: accuracy }).addTo(map);
  
 <!-- adding in an if statement to have the circle update in tandem with map zoom level -->
  if (!zoomed) {
        zoomed = map.fitBounds(circle.getBounds()); 
    }
  <!-- keeping the map at the same zoom level whenever the map location changes -->
if (!zoomed) {
        zoomed = map.fitBounds(circle.getBounds()); 
    }
  <!--setting the map focus to update with the users position -->
   map.setView([lat, lng]);
    

}

function error(err) {
<!-- altering the user if they do not allow geolocatoion access or if there is a user error -->
    if (err.code === 1) {
        alert("Please allow geolocation access");
    } else {
        alert("Cannot get current location");
    }
}
	    <!-- adding in the properties for the choropleth map from the variable in the javascript file  and the fields listed in the file along with a pop up --> 
L.choropleth(WalkIndex, {
	valueProperty: 'NatWalkInd', // which property in the features to use
	scale: ['white', 'green'], // chroma.js scale - include as many as you like
	steps: 5, // number of breaks or steps in range
	mode: 'q', // q for quantile, e for equidistant, k for k-means
	style: {
		color: '#fff', 
		 weight: 1,
		fillOpacity: 0.3
	},

       <!--adding a pop up for the national walkability idnex scores, had to convert the format to a stirng in order to be viewed--> -->
     onEachFeature: function(feature, layer) {
        const natWalkIndString = feature.properties.NatWalkInd.toString();
        layer.bindPopup(natWalkIndString);
    }
}).addTo(map);
function getColor(d) {
    return d > 20 ? '#800026' :
	   d > 17.5 ? '#800026' :
           d > 15  ? '#BD0026' :
           d > 12.5  ? '#E31A1C' :
           d > 10  ? '#FC4E2A' :
           d > 7.5   ? '#FD8D3C' :
           d > 5   ? '#FEB24C' :
           d > 2.5   ? '#FED976' :
                      '#FFEDA0';
}
  var legend = L.control({position: 'bottomright'});

legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
    grades = [0, 2.5, 5, 7.5, 10, 12.5, 15, 17.5, 20],
    labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
}

return div;
};

legend.addTo(map);



	    
    </script>
  </body>
</html>
